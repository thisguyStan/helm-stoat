# Config Reference: https://github.com/stoatchat/stoatchat/blob/stable/crates/core/config/Revolt.toml
# Default values for stoat.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.


global:
  namespace: 'stoatchat'
  # Domain name used for access, ex stoat.example.com
  domain: 'stoat.example.com'

  # Master secret seed for deriving infrastructure passwords
  # Generate with: openssl rand -hex 24
  # Leave empty to generate random passwords on each install (non-reproducible)
  # Provide a seed to make all passwords deterministic and reproducible
  secretSeed: ''
  
  # Alternative: Read secretSeed from an existing Kubernetes Secret
  # If set, this takes precedence over secretSeed above (more secure)
  # Example:
  #   existingSecretSeed:
  #     name: "stoatchat-master-seed"
  #     namespace: "default"  # optional, defaults to release namespace
  #     key: "secretSeed"     # optional, defaults to "secretSeed"
  existingSecretSeed:
    name: ""
    # namespace: ""  # optional
    # key: "secretSeed"  # optional

  secret:
    # VAPID keys for push notifications (required)
    # Generate with: ./generate_keys.sh
    # Or leave empty if secret already exists from previous install
    vapid_key: ''
    vapid_public_key: ''
    # File encryption key (auto-derived from secretSeed if empty)
    encryption_key: ''

  web:
    port: 5000
  api:
    port: 14702
  bonfire:
    port: 14703
  autumn:
    port: 14704
  january:
    port: 14705
  gifbox:
    port: 14706

  livekit:
  - name: 'worldwide'
    secret: ''  # Auto-derived from secretSeed if empty
    subdomain: ''
    # Ports (defaults shown, override if needed)
    http_port: 7880       # HTTP API port
    rtc_tcp_port: 7881    # RTC TCP port
    rtc_udp_port: 7882    # RTC UDP port
    # existingSecret: ''  # optional - name of an existing Secret containing keys.yaml (e.g. CSI-backed)
    # host: ''            # optional - format in the file must be "<name>: <secret>" where name matches the instance name (e.g. "worldwide: mysecretvalue") 
    # lat: 0.0 # optional
    # lon: 0.0 # optional
    # affinity: {}      # optional - standard Kubernetes affinity spec    - merged with top-level livekit.affinity (per-instance wins on conflict)
    # tolerations: []   # optional - standard Kubernetes tolerations list - concatenated with top-level livekit.tolerations

  # Application configuration (maps to Revolt.toml)
  config:
    # Registration settings
    registration:
      invite_only: false

    # SMTP for email verification (leave host empty to disable)
    smtp:
      host: ''
      username: ''
      password: ''
      from_address: 'noreply@example.com'
      # port: 587
      # use_tls: true
      # reply_to: ''

    # Security settings
    security:
      # Enable if behind Cloudflare proxy
      trust_cloudflare: false
      # Authifier Shield API key
      authifier_shield_key: ''
      # Tenor GIF API key
      tenor_key: ''
      # hCaptcha configuration (leave empty to disable)
      captcha:
        hcaptcha_key: ''
        hcaptcha_sitekey: ''

    # Feature toggles
    features:
      webhooks_enabled: false
      mass_mentions_send_notifications: true
      mass_mentions_enabled: true

    # File handling settings
    files:
      # Quality for lossy WebP previews (1-100, 100 = lossless)
      webp_quality: 80.0
      # Mime types that cannot be uploaded or served
      blocked_mime_types: []
      # ClamAV antivirus hostname:port (leave empty to disable)
      clamd_host: ''

    # Livekit API settings
    livekit:
      # How long to ring devices when calling (seconds)
      call_ring_duration: 30

    # Push notification services (leave empty to disable)
    pushd:
      fcm:
        key_type: ''
        project_id: ''
        private_key_id: ''
        private_key: ''
        client_email: ''
        client_id: ''
        auth_uri: ''
        token_uri: ''
        auth_provider_x509_cert_url: ''
        client_x509_cert_url: ''
      apn:
        sandbox: false
        pkcs8: ''
        key_id: ''
        team_id: ''

    # Sentry error reporting DSNs (leave empty to disable)
    sentry:
      api: ''
      events: ''
      voice_ingress: ''
      files: ''
      proxy: ''
      pushd: ''
      crond: ''
      gifbox: ''

    # Feature limits
    limits:
      global:
        group_size: 100
        message_embeds: 5
        message_replies: 5
        message_reactions: 20
        server_emoji: 100
        server_roles: 200
        server_channels: 200
        new_user_hours: 72
        body_limit_size: 20000000
      new_user:
        outgoing_friend_requests: 5
        bots: 2
        message_length: 2000
        message_attachments: 5
        servers: 50
        voice_quality: 16000
        video: true
        video_resolution: [1080, 720]
        video_aspect_ratio: [0.3, 2.5]
        file_upload_size_limit:
          attachments: 20000000
          avatars: 4000000
          backgrounds: 6000000
          icons: 2500000
          banners: 6000000
          emojis: 500000
      default:
        outgoing_friend_requests: 10
        bots: 5
        message_length: 2000
        message_attachments: 5
        servers: 100
        voice_quality: 16000
        video: true
        video_resolution: [1080, 720]
        video_aspect_ratio: [0.3, 2.5]
        file_upload_size_limit:
          attachments: 20000000
          avatars: 4000000
          backgrounds: 6000000
          icons: 2500000
          banners: 6000000
          emojis: 500000

  ingress:
    enabled: false
    className: ''
    annotations: {}
    extra_hosts: []
  serviceAccount:
    create: true
    automount: true
    annotations: { }
    name: ""

  subcharts:
    mongodb:
      enabled: true  # Set to false to use external MongoDB
      connection_url: ''  # If set, overrides auto-generated internal connection
    redis:
      enabled: true  # Set to false to use external Redis
      connection_url: ''  # If set, overrides auto-generated internal connection
    minio:
      enabled: true  # Set to false to use external MinIO
      connection_url: ''  # If set, overrides auto-generated internal connection
      access_key_id: ''  # If set, overrides auto-derived credential
      secret_access_key: ''  # If set, overrides auto-derived credential
    rabbitmq:
      enabled: true  # Set to false to use external RabbitMQ
      host: ''  # If set, uses external RabbitMQ
      port: 5672
      username: 'rabbituser'
      # Password auto-derived from secretSeed for internal RabbitMQ


mongodb:
  architecture: standalone
  auth:
    enabled: true
    existingSecret: "stoatchat-mongodb"  # Auto-generated, override to use external
  persistence:
    enabled: false


redis:
#  image:
#    repository: eqalpha/keydb
#    tag: x86_64_v6.3.4
#    pullPolicy: IfNotPresent
  architecture: standalone
  auth:
    enabled: true
    existingSecret: "stoatchat-redis"  # Auto-generated, override to use external
    existingSecretPasswordKey: "redis-password"
  master:
    persistence:
      enabled: false


rabbitmq:
  replicaCount: 1
  auth:
    username: "rabbituser"
    existingPasswordSecret: "stoatchat-rabbitmq"  # Auto-generated, override to use external
  persistence:
    enabled: false


minio:
  mode: standalone
  auth:
    existingSecret: "stoatchat-minio"  # Auto-generated, override to use external
  persistence:
    enabled: false


# Web app
web:
  image:
    # Requires custom build - see build/BUILD-IMAGES.md
    repository: ghcr.io/thisguystan/stoat-for-web
    tag: "video-test"
    pullPolicy: IfNotPresent
  annotations: {}
  labels: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  replicaCount: 1
  resources: {}
  livenessProbe:
  readinessProbe:
  service:
    type: ClusterIP
  extra_volumes: []
  extra_volumeMounts: []


# Revolt API Server
api:
  image:
    repository: ghcr.io/stoatchat/api
    tag: "v0.11.1"
    pullPolicy: IfNotPresent
  replicaCount: 1
  annotations: {}
  labels: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  resources: {}
  livenessProbe:
  readinessProbe:
  service:
    type: ClusterIP
  extra_volumes: []
  extra_volumeMounts: []
  configMountPath: /Revolt.toml


# Livekit Server
livekit:
  image:
    repository: ghcr.io/stoatchat/livekit-server
    tag: "v1.9.9"
    pullPolicy: IfNotPresent
  annotations: {}
  labels: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  resources: {}
  service:
    type: ClusterIP
  extra_volumes: []
  extra_volumeMounts: []


# Events service
bonfire:
  image:
    repository: ghcr.io/stoatchat/events
    tag: "v0.11.1"
    pullPolicy: IfNotPresent
  replicaCount: 1
  annotations: {}
  labels: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  resources: {}
  livenessProbe:
  readinessProbe:
  service:
    type: ClusterIP
  extra_volumes: []
  extra_volumeMounts: []
  configMountPath: /Revolt.toml


# File server
autumn:
  image:
    repository: ghcr.io/stoatchat/file-server
    tag: "v0.11.1"
    pullPolicy: IfNotPresent
  replicaCount: 1
  annotations: {}
  labels: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  resources: {}
#  livenessProbe:
  livenessProbe: {}
  readinessProbe:
  service:
    type: ClusterIP
  extra_volumes: []
  extra_volumeMounts: []
  configMountPath: /Revolt.toml

# Metadata and image proxy
january:
  image:
    repository: ghcr.io/stoatchat/proxy
    tag: "v0.11.1"
    pullPolicy: IfNotPresent
  replicaCount: 1
  annotations: {}
  labels: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  resources: {}
  livenessProbe:
  readinessProbe:
  service:
    type: ClusterIP
  extra_volumes: []
  extra_volumeMounts: []
  configMountPath: /Revolt.toml

# Regular task daemon
crond:
  image:
    repository: ghcr.io/stoatchat/crond
    tag: "v0.11.1"
    pullPolicy: IfNotPresent
  replicaCount: 1
  annotations: {}
  labels: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  resources: {}
  livenessProbe:
  readinessProbe:
  extra_volumes: []
  extra_volumeMounts: []
  configMountPath: /Revolt.toml

# Push notification daemon
pushd:
  image:
    repository: ghcr.io/stoatchat/pushd
    tag: "v0.11.1"
    pullPolicy: IfNotPresent
  replicaCount: 1
  annotations: {}
  labels: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  resources: {}
  livenessProbe:
  readinessProbe:
  extra_volumes: []
  extra_volumeMounts: []
  configMountPath: /Revolt.toml

# Voice ingress service
voiceIngress:
  image:
    repository: ghcr.io/stoatchat/voice-ingress
    tag: "v0.11.1"
    pullPolicy: IfNotPresent
  replicaCount: 1
  annotations: {}
  labels: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  resources: {}
  livenessProbe:
  readinessProbe:
  service:
    type: ClusterIP
  extra_volumes: []
  extra_volumeMounts: []
  configMountPath: /Revolt.toml

# Tenor GIF proxy
# NOTE: As of 15.feb.2025, the web app does not have a configurable gifbox host
gifbox:
  enabled: false
  image:
    repository: ghcr.io/stoatchat/gifbox
    tag: "v0.11.1"
    pullPolicy: IfNotPresent
  replicaCount: 1
  annotations: {}
  labels: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  resources: {}
  livenessProbe:
  readinessProbe:
  service:
    type: ClusterIP
  extra_volumes: []
  extra_volumeMounts: []
  configMountPath: /Revolt.toml
